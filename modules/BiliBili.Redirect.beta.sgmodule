#!name=📺 BiliBili: 🔀 Redirect β
#!desc=(BETA) 哔哩哔哩：重定向（自定义 CDN）
#!openUrl=http://boxjs.com/#/app/BiliBili.Redirect.beta
#!author=VirgilClyne
#!homepage=https://redirect.biliuniverse.io
#!manual=https://manual.biliuniverse.io
#!icon=https://github.com/BiliUniverse/Redirect/raw/main/src/assets/icon_rounded_108x.png
#!category=📺 BiliUniverse

[General]
# > TCP Force HTTP Hosts
# 让 Surge 把 TCP 连接当作 HTTP 请求来处理。Surge HTTP 引擎将处理这些请求，所有的高级功能，如捕获、重写和脚本等都可以使用。
force-http-engine-hosts = %APPEND% *:4480, *:8000, *:9102

[Rule]
URL-REGEX,^https?:\/\/(.*):(8000)\/v1\/resource\/,REJECT

[Script]
BiliBili.Redirect.CDN.m4s = type=http-request, pattern=https?:\/\/.+\.bilivideo\.com\/upgcxcode\/, requires-body=0, engine=jsc, debug=1, script-path=https://raw.githubusercontent.com/BiliUniverse/Redirect/beta/js/BiliBili.Redirect.request.beta.js, argument=
BiliBili.Redirect.MCDN.m4s = type=http-request, pattern=https?:\/\/[xy0-9]+\.mcdn\.bilivideo\.cn\/upgcxcode\/, requires-body=0, engine=jsc, debug=1, script-path=https://raw.githubusercontent.com/BiliUniverse/Redirect/beta/js/BiliBili.Redirect.request.beta.js, argument=
BiliBili.Redirect.PCDN.m4s = type=http-request, pattern=https?:\/\/(.+\.v1d\.szbdyd\.com|.+):(4480|4483|9102)\/upgcxcode\/, requires-body=0, engine=jsc, debug=1, script-path=https://raw.githubusercontent.com/BiliUniverse/Redirect/beta/js/BiliBili.Redirect.request.beta.js, argument=
BiliBili.Redirect.Akamaized.m4s = type=http-request, pattern=https?:\/\/upos-hz-mirrorakam\.akamaized\.net\/upgcxcode\/, requires-body=0, engine=jsc, debug=1, script-path=https://raw.githubusercontent.com/BiliUniverse/Redirect/beta/js/BiliBili.Redirect.request.beta.js, argument=

[MITM]
hostname = %APPEND% *.mcdn.bilivideo.cn:4483, *.mcdn.bilivideo.com:4483, *.mcdn.bilivideo.cn:8082, *.mcdn.bilivideo.com:8082, upos-hz-mirrorakam.akamaized.net
h2 = true
